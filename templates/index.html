<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raspberry Pi Monitor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .progress-bar { transition: width 0.5s ease-in-out; }
        .card { transition: background-color 0.5s ease-in-out, border-color 0.5s ease-in-out; }
        .table-auto th, .table-auto td { @apply px-4 py-2 text-sm; }
        .table-auto th { @apply font-semibold; }
        .table-auto td { @apply text-gray-300; }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4 sm:p-6">

    <div class="w-full max-w-7xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-cyan-400">Painel de Controle - Raspberry Pi</h1>
            <p class="text-gray-400 mt-2">Monitoramento de recursos do sistema em tempo real</p>
        </header>

        <main class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <!-- Card: Temperatura da CPU -->
            <div id="temp-card" class="card bg-gray-800 p-6 rounded-xl shadow-lg flex flex-col justify-between border-2 border-transparent">
                <div>
                    <div class="flex justify-between items-center"><h2 class="text-lg font-semibold text-gray-300">Temperatura</h2><span id="temp-status-icon" class="text-2xl"></span></div>
                    <p id="cpu-temp" class="text-5xl font-bold text-white mt-2">--</p>
                </div>
                <div id="temp-status-text" class="text-sm font-medium mt-4">Status: Verificando...</div>
            </div>

            <!-- Card: Uso da CPU -->
            <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
                <h2 class="text-lg font-semibold text-gray-300">Uso da CPU</h2>
                <p class="text-5xl font-bold text-white mt-2"><span id="cpu-usage">--</span>%</p>
                <div class="w-full bg-gray-700 rounded-full h-2.5 mt-4"><div id="cpu-progress" class="bg-cyan-500 h-2.5 rounded-full progress-bar" style="width: 0%"></div></div>
            </div>

            <!-- Card: Uso de Mem√≥ria RAM -->
            <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
                <h2 class="text-lg font-semibold text-gray-300">Mem√≥ria (RAM)</h2>
                <p class="text-2xl font-bold text-white mt-2"><span id="mem-used">--</span> / <span id="mem-total">--</span></p>
                <div class="w-full bg-gray-700 rounded-full h-2.5 mt-4"><div id="mem-progress" class="bg-purple-500 h-2.5 rounded-full progress-bar" style="width: 0%"></div></div>
                <p class="text-right text-lg font-medium mt-2"><span id="mem-percent">--</span>%</p>
            </div>

            <!-- Card: Uso de Mem√≥ria SWAP -->
            <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
                <h2 class="text-lg font-semibold text-gray-300">Mem√≥ria (Swap)</h2>
                <p class="text-2xl font-bold text-white mt-2"><span id="swap-used">--</span> / <span id="swap-total">--</span></p>
                <div class="w-full bg-gray-700 rounded-full h-2.5 mt-4"><div id="swap-progress" class="bg-orange-500 h-2.5 rounded-full progress-bar" style="width: 0%"></div></div>
                <p class="text-right text-lg font-medium mt-2"><span id="swap-percent">--</span>%</p>
            </div>

            <!-- Card: Uso de Armazenamento -->
            <div class="bg-gray-800 p-6 rounded-xl shadow-lg lg:col-span-2">
                <h2 class="text-lg font-semibold text-gray-300">Armazenamento (Disco)</h2>
                 <p class="text-3xl font-bold text-white mt-2"><span id="disk-used">--</span> / <span id="disk-total">--</span></p>
                <div class="w-full bg-gray-700 rounded-full h-2.5 mt-4"><div id="disk-progress" class="bg-green-500 h-2.5 rounded-full progress-bar" style="width: 0%"></div></div>
                <p class="text-right text-lg font-medium mt-2"><span id="disk-percent">--</span>%</p>
            </div>

            <!-- Card: Informa√ß√µes do Sistema -->
            <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
                <h2 class="text-lg font-semibold text-gray-300 mb-3">Info Sistema</h2>
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between"><span>Tempo Ativo:</span> <strong id="uptime">--</strong></div>
                    <div class="flex justify-between"><span>Processos:</span> <strong id="processes">--</strong></div>
                </div>
            </div>

            <!-- Card: Carga M√©dia -->
            <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
                <h2 class="text-lg font-semibold text-gray-300 mb-3">Carga M√©dia (Load)</h2>
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between"><span>√öltimo 1 min:</span> <strong id="load-1">--</strong></div>
                    <div class="flex justify-between"><span>√öltimos 5 min:</span> <strong id="load-5">--</strong></div>
                    <div class="flex justify-between"><span>√öltimos 15 min:</span> <strong id="load-15">--</strong></div>
                </div>
            </div>

            <!-- NOVA SE√á√ÉO: Cont√™ineres em Execu√ß√£o -->
            <div class="bg-gray-800 p-6 rounded-xl shadow-lg lg:col-span-4">
                <h2 class="text-lg font-semibold text-gray-300 mb-4">Cont√™ineres em Execu√ß√£o</h2>
                <div class="overflow-x-auto max-h-72">
                    <table class="table-auto w-full text-left">
                        <thead class="sticky top-0 bg-gray-800">
                            <tr><th>Nome</th><th>ID</th><th>Imagem</th><th>Status</th><th>Tempo Ativo</th></tr>
                        </thead>
                        <tbody id="containers-table-body">
                           <!-- Linhas ser√£o inseridas aqui via JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Tabela: Portas em Escuta -->
            <div class="bg-gray-800 p-6 rounded-xl shadow-lg lg:col-span-4">
                <h2 class="text-lg font-semibold text-gray-300 mb-4">Portas em Escuta (Listening)</h2>
                <div class="overflow-x-auto max-h-60">
                    <table class="table-auto w-full text-left">
                        <thead class="sticky top-0 bg-gray-800">
                            <tr><th>Porta</th><th>Protocolo</th><th>Aplica√ß√£o</th><th>PID</th></tr>
                        </thead>
                        <tbody id="ports-table-body">
                           <!-- Linhas ser√£o inseridas aqui via JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script>
        async function updateStats() {
            try {
                const response = await fetch('/stats');
                const data = await response.json();

                // --- Se√ß√£o de Temperatura ---
                const tempCard = document.getElementById('temp-card');
                tempCard.classList.remove('bg-yellow-900', 'border-yellow-500', 'bg-red-900', 'border-red-500');
                if (data.cpu_temp_raw === null) {
                    document.getElementById('temp-status-text').textContent = 'Status: Erro';
                    document.getElementById('temp-status-icon').textContent = '‚ö†Ô∏è';
                } else if (data.cpu_temp_raw >= data.temp_limits.critical) {
                    tempCard.classList.add('bg-red-900', 'border-red-500');
                    document.getElementById('temp-status-text').textContent = `Status: Cr√≠tico!`;
                    document.getElementById('temp-status-icon').textContent = 'üî•';
                } else if (data.cpu_temp_raw >= data.temp_limits.warning) {
                    tempCard.classList.add('bg-yellow-900', 'border-yellow-500');
                    document.getElementById('temp-status-text').textContent = `Status: Aten√ß√£o`;
                    document.getElementById('temp-status-icon').textContent = '‚ö†Ô∏è';
                } else {
                    document.getElementById('temp-status-text').textContent = 'Status: Normal';
                    document.getElementById('temp-status-icon').textContent = '‚úÖ';
                }
                document.getElementById('cpu-temp').textContent = data.cpu_temp;

                // --- Outras M√©tricas ---
                document.getElementById('cpu-usage').textContent = data.cpu_usage.toFixed(1);
                document.getElementById('cpu-progress').style.width = data.cpu_usage + '%';
                document.getElementById('mem-used').textContent = data.mem_used;
                document.getElementById('mem-total').textContent = data.mem_total;
                document.getElementById('mem-percent').textContent = data.mem_percent.toFixed(1);
                document.getElementById('mem-progress').style.width = data.mem_percent + '%';
                document.getElementById('swap-used').textContent = data.swap_used;
                document.getElementById('swap-total').textContent = data.swap_total;
                document.getElementById('swap-percent').textContent = data.swap_percent.toFixed(1);
                document.getElementById('swap-progress').style.width = data.swap_percent + '%';
                document.getElementById('disk-used').textContent = data.disk_used;
                document.getElementById('disk-total').textContent = data.disk_total;
                document.getElementById('disk-percent').textContent = data.disk_percent.toFixed(1);
                document.getElementById('disk-progress').style.width = data.disk_percent + '%';
                document.getElementById('uptime').textContent = data.uptime;
                document.getElementById('processes').textContent = data.processes;
                document.getElementById('load-1').textContent = data.load_avg.min1.toFixed(2);
                document.getElementById('load-5').textContent = data.load_avg.min5.toFixed(2);
                document.getElementById('load-15').textContent = data.load_avg.min15.toFixed(2);
                document.getElementById('net-sent').textContent = data.net_sent;
                document.getElementById('net-recv').textContent = data.net_recv;

                // --- Tabela de Cont√™ineres ---
                const containersTableBody = document.getElementById('containers-table-body');
                containersTableBody.innerHTML = ''; // Limpa a tabela
                if (data.running_containers.length === 0) {
                    containersTableBody.innerHTML = '<tr><td colspan="5" class="text-center text-gray-500">Nenhum cont√™iner em execu√ß√£o.</td></tr>';
                } else {
                    data.running_containers.forEach(c => {
                        const row = `<tr>
                            <td class="font-medium text-white">${c.name}</td>
                            <td>${c.id}</td>
                            <td class="truncate max-w-xs">${c.image}</td>
                            <td>${c.status}</td>
                            <td>${c.uptime}</td>
                        </tr>`;
                        containersTableBody.innerHTML += row;
                    });
                }

                // --- Tabela de Portas ---
                const portsTableBody = document.getElementById('ports-table-body');
                portsTableBody.innerHTML = '';
                if (data.listening_ports.length === 0) {
                    portsTableBody.innerHTML = '<tr><td colspan="4" class="text-center text-gray-500">Nenhuma porta em escuta.</td></tr>';
                } else {
                    data.listening_ports.forEach(p => {
                        const row = `<tr><td>${p.port}</td><td>${p.protocol}</td><td class="truncate">${p.process}</td><td>${p.pid}</td></tr>`;
                        portsTableBody.innerHTML += row;
                    });
                }

            } catch (error) {
                console.error("Erro ao buscar estat√≠sticas:", error);
            }
        }

        setInterval(updateStats, 3000); // Aumentei o intervalo para 3s para acomodar a chamada extra √† API do Docker
        window.onload = updateStats;
    </script>
</body>
</html>